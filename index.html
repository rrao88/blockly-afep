<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Blockly - Smart Contract</title>

		<script src="blockly_compressed.js"></script>
		<script src="blocks_compressed.js"></script>
		<script src="msg/js/en-gb.js"></script>

		<script src="blocks/contract/seller.js"></script>
		<script src="blocks/contract/contract.js"></script>
		<script src="generators/solidity.js"></script>
		<script src="generators/solidity/contract/contract.js"></script>
		<script src="generators/solidity/contract/seller.js"></script>
		<script src="generators/solidity/core/math.js"></script>
		<script src="generators/solidity/core/text.js"></script>
		<script src="generators/solidity/core/variables.js"></script>

		<style>
			body {
				background-color: #fff;
				font-family: sans-serif;
			}

			h1 {
				font-weight: normal;
				font-size: 140%;
			}

			.blockly-div {
				float: left;
				width: 750px;
				height: 620px;
				margin-right: 10px;
			}

			.code-div {
				height: 614px;
				background-color: #ffd77b;
				width: calc(39%);
			}
		</style>
	</head>
	<body>
		<h1>Kaufvertrag mit Blockly</h1>

		<div id="blocklyDiv" class="blockly-div"></div>
		<textarea id="codeDiv" class="code-div"></textarea>

		<xml id="toolbox" style="display: none">
			<category name="Contract">
				<category name="Type" colour="120">
					<block type="contract_main"></block>
				</category>
				<category name="Parties" colour="180">
					<block type="contract_seller"></block>
				</category>
				<category name="Objects" colour="230">
				</category>
			</category>
			<category name="Core">
				<category name="Math" colour="290">
					<block type="math_number"></block>
					<block type="math_arithmetic"></block>
				</category>
				<category name="Text" colour="345">
					<block type="text"></block>
				</category>
				<category name="Variables" colour="400">
				</category>
			</category>
		</xml>

		<script>
			var workspace = Blockly.inject('blocklyDiv',
				{
					media: 'media/',
					toolbox: document.getElementById('toolbox'),
					grid:
						{
							spacing: 20,
							length: 3,
							colour: '#ccc',
							snap: true
						},
					zoom:
						{
							controls: true,
							wheel: true,
							startScale: 1.0,
							maxScale: 3,
							minScale: 0.3,
							scaleSpeed: 1.2
						},
					trashcan: true
				});


			function updateGeneratedCode() {
				Blockly.Solidity.INFINITE_LOOP_TRAP = null;

				//TODO: create Validator function and write validation output to UI in a separate field
				document.getElementById('codeDiv').value = Blockly.Solidity.workspaceToCode(workspace);
			}

			workspace.addChangeListener(updateGeneratedCode);
		</script>
	</body>
</html>